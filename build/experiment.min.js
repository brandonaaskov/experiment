angular.module("experiment",["ngRoute","ngCookies","templates","firebase","ui.bootstrap"]).run(["$cookies","utils","analytics",function(e,n,t){e.guid||(e.guid=n.createGuid()),t.identify(e.guid)}]),angular.module("experiment").controller("uploadsController",["$scope","firebase",function(e,n){return e.userUploads=[],e.gridOptions={data:"userUploads",columnDefs:[{field:"displayName",displayName:"Name"},{field:"filename",displayName:"Filename"},{field:"job",displayName:"Zencoder Job"},{field:"size",displayName:"Size"}]},e.userUploads=n.userUploads}]),angular.module("experiment").factory("analytics",function(){var e={};return _(["page","pageview","track","identify"]).each(function(n){return e[n]=function(){var e=[].slice.call(arguments,0);return window.analytics[n].apply(window.analytics,e)}}),e}).run(["analytics","$rootScope",function(e,n){n.$on("$routeChangeSuccess",function(){e.page()})}]),angular.module("experiment").service("auth",["$firebase","$firebaseAuth","$cookies","config","$rootScope",function(e,n,t,r,i){var o=n(r.firebase["default"]),a=e(r.firebase.users),u=void 0,c=void 0,s=function(){var n=o.$getAuth();u=n?e(r.firebase.users.child(n.uid)).$asObject():null,i.user=u,u&&u.$bindTo(i,"user").then(function(e){c=e})},l=function(e){o.$getAuth()?a.$update(e.uid,e[e.provider]):a.$set(e.uid,e[e.provider]),s()},d=function(e){console.error("login error",e)},p=function(e){switch(e){case"facebook":return o.$authWithOAuthPopup("facebook").then(l)["catch"](d);case"github":return o.$authWithOAuthPopup("github").then(l)["catch"](d);case"twitter":return o.$authWithOAuthPopup("twitter").then(l)["catch"](d)}},f=function(){c(),o.$unauth(),i.user=null};return s(),{login:p,logout:f}}]),angular.module("experiment").service("config",["$window",function(e){return{env:"development",firebase:{"default":new e.Firebase("https://drum-machine.firebaseio.com/"),users:new e.Firebase("https://drum-machine.firebaseio.com/users"),clock:new e.Firebase("https://drum-machine.firebaseio.com/.info/serverTimeOffset"),auth:{facebook:{scope:"user_friends,user_birthday,friends_birthday",rememberMe:!0},github:{scope:"user:email",rememberMe:!0},twitter:{rememberMe:!0}}}}}]),angular.module("experiment").service("firebase",["$firebase","$cookies","config","$rootScope","$q",function(e,n,t,r,i){var o=new Firebase(t.firebase.clock);return guid=n.guid,getServerTime=function(){var e=i.defer();return o.on("value",function(n){var t=Date.now()+n.val();return e.resolve(t)}),e.promise},publicAPI={getServerTime:getServerTime,guid:guid}}]),angular.module("experiment").service("liveSync",["firebase","$window",function(e,n){var t,r,i;return navigator.getMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia,t=n.AudioContext||n.webkitAudioContext,i=function(e,n,r){var i,o,a;return o=(n-e)%r,console.log("jumpTo (in seconds)",o/1e3),console.log("jumpTo (in minutes)",o/1e3/60),i={video:!1,audio:!0},a=function(e){var n,r,i;return n=new t,i=n.createMediaStreamSource(e),r=n.createBiquadFilter(),i.connect(r),r.connect(n.destination)},navigator.getMedia(i,a)},e.getServerTime().then(function(e){var n,t;return t=13956876e5,n=132e4,i(t,e,n)}),r={sync:i}}]);var routes={"/":{templateUrl:"home.html"},"/speech":{templateUrl:"speech.html"},"/drum-machine":{templateUrl:"drum-machine.html"}};angular.module("experiment").config(["$routeProvider",function(e){for(var n in routes)e.when(n,routes[n]);return e.otherwise({redirectTo:"/404"})}]),angular.module("experiment").service("utils",function(){var e=function(e){return _.isUndefined(e)?!1:!_.isObject(e)||_.isFunction(e)||_.isArray(e)||_.isElement(e)?!1:!0},n=function(e){return _(e).isNumber()&&!_(e).isNaN()?!0:!1},t=function(e){var t=parseInt(e,10);return n(t)?t:e},r=function(e,n){if(!_.isString(n)||_.isEmpty(n)||!e)throw new Error("The second argument supplied to findValue() should be a string of the property name that you're looking for.");var t=null;return _.find(e,function(e,i){return String(i).toLowerCase()===String(n).toLowerCase()?t=e:_.isObject(e)&&!_.isElement(e)&&(t=r(e,n)),null!=t?t:void 0}),t},i=function(e,n){if(!_.isArray(n))throw new Error("findValues() expects an array of strings for property names to find");var t={};return _.each(n,function(e){return t[e]=r(this,e)},e),t},o=function(e,n){var t={};if(!_.isObject(e||!_.isObject(n)))throw new Error("Both arguments supplied to override() should be shallow objects.");return t=_.defaults(e,n),angular.forEach(e,function(e,r){return angular.forEach(n,function(e,n){return r===n?t[r]=e:void 0})}),t},a=function(e,n){var t=_.last(e.split("/"));return n||(n=!0),n?_.first(t.split(".")):t},u=function(){function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()};return publicAPI={isTrueObject:e,isValidNumber:n,makeNumber:t,findValue:r,findValues:i,override:o,getFilename:a,createGuid:u}}),angular.module("experiment").service("zencoder",["$http","firebase",function(e,n){var t,r,i,o,a,u,c;return a=n.guid,t="https://app.zencoder.com/api/v2",u={read:"92cdc58ec35e590acb0980f75ddfa32c",full:"380e390b6b8fd2d600c9035db7d13c29"},r=function(n){return e.post(""+t+"/jobs",o(n))},i=function(n){return e.get(""+t+"/jobs/"+n+"/progress.json?api_key="+u.full)},o=function(e){var n;return n=_.getFilename(e),t="s3://fullscreen-tv",{input:""+t+"/"+e,outputs:[{label:"low",format:"mp4",video_bitrate:200,decoder_bitrate_cap:300,decoder_buffer_size:1200,audio_sample_rate:44100,height:"288",url:""+t+"/encodes/"+a+"/"+n+"-low.mp4",h264_reference_frames:1,forced_keyframe_rate:"0.1",audio_bitrate:56,decimate:2,rrs:!0},{label:"high",format:"mp4",video_bitrate:1e3,decoder_bitrate_cap:1500,decoder_buffer_size:6e3,audio_sample_rate:44100,height:"432",url:""+t+"/encodes/"+a+"/"+n+"-high.mp4",h264_reference_frames:"auto",h264_profile:"main",forced_keyframe_rate:"0.1",audio_bitrate:56,rrs:!0},{source:"low",segment_video_snapshots:"true",url:""+t+"/encodes/"+a+"/"+n+"-audio-only.m4a",copy_audio:"true",skip_video:"true",label:"hls-audio-only",type:"segmented",format:"aac",rrs:!0},{source:"low",format:"ts",copy_audio:"true",copy_video:"true",url:""+t+"/encodes/"+a+"/"+n+"-hls-low.mp4",label:"hls-low",type:"segmented",rrs:!0},{source:"high",format:"ts",copy_audio:"true",copy_video:"true",url:""+t+"/encodes/"+a+"/"+n+"-hls-high.mp4",label:"hls-high",type:"segmented",rrs:!0},{streams:[{path:"hls-low/"+n+"-hls-low.m3u8",bandwidth:256},{path:"hls-audio-only/"+n+"-hls-audio-only.m3u8",bandwidth:56},{path:"hls-high/"+n+"-hls-high.m3u8",bandwidth:1056}],type:"playlist",url:""+t+"/encodes/"+a+"/"+n+".m3u8"}]}},c={createJob:r,getJobProgress:i}}]).config(["$httpProvider",function(e){return e.defaults.headers.common={},e.defaults.headers.post={},e.defaults.headers.post["Zencoder-Api-Key"]="380e390b6b8fd2d600c9035db7d13c29"}]),angular.module("experiment").directive("contenteditable",function(){return{restrict:"A",require:"ngModel",scope:{onBlur:"&"},link:function(e,n,t,r){return n.bind("keypress",function(){return function(e){return 13===e.keyCode?(e.preventDefault(),$(n).trigger("blur")):void 0}}(this)),n.bind("blur",function(){return e.$apply(function(){return r.$setViewValue(n.html()),n.addClass("edited"),e.onBlur()})}),r.$render=function(){return function(){return n.html(r.$viewValue)}}(this),r.$render()}}}),angular.module("experiment").directive("drumLoop",["$interval","utils",function(e,n){return{restrict:"E",replace:!1,templateUrl:"drum-loop.html",link:function(t){var r=void 0;t.isPlaying=!1,t.timeSignature={beats:4,note:4};var i=function(e,r){var e=e||4,r=r||4,i={beats:e,note:r};n.override(t.timeSignature,i)},o=function(e){var e=e||120;return Math.round(60/e*1e3)},a=function(){t.isPlaying=!0,r=e(function(){},o())},u=function(){t.isPlaying=!1,e.cancel(r)};i(),t.play=a,t.stop=u}}}]),angular.module("experiment").directive("filepicker",["$window","firebase","analytics","zencoder",function(e,n,t,r){return{restrict:"A",link:function(n){return n.filepicker=e.filepicker,n.filepicker.setKey("AiCDu1zCuQQysPoX9Mb9bz")},controller:["$scope",function(e){var i,o,a,u,c;return o={picker:{services:["COMPUTER","DROPBOX","BOX","GOOGLE_DRIVE"],container:"window",multiple:!0,mimetype:"video/*"},store:{path:"uploads/"+n.guid+"/"}},c=function(e){return a(e),u(e),t.track("Upload: Success",e)},i=function(e){return t.track("Upload: Error",e.toString())},a=function(e){return _(e).each(function(e){var t;return t=_.getFilename(e.key),e.displayName=t,n.userUploads[t]=e,n.userUploads.$save(t)})},u=function(e){var t;return t=_(e).pluck("key"),_(t).each(function(e){var t;return t=_.getFilename(e),console.log("filename",t),r.createJob(e).then(function(e){return n.userUploads.$child(t).$update({job:e.data.id}),n.userEncodes.$child(t).$update({jobId:e.data.id,files:e.data.outputs})})})},e.pick=function(){return e.filepicker.pickAndStore(o.picker,o.store,c,i)}}]}}]),angular.module("experiment").directive("icon",function(){return{restrict:"EA",replace:!0,templateUrl:"icon.html",scope:{glyph:"@"},link:function(e){console.log("scope",e)}}}),angular.module("experiment").directive("instrument",function(){return{restrict:"E",replace:!1,scope:{},templateUrl:"instrument.html",link:function(e,n){e.enabled=!1,n.bind("click",function(){e.$apply(function(){e.enabled=!e.enabled})})}}}),angular.module("experiment").directive("navigation",["auth",function(e){return{restrict:"E",replace:!0,templateUrl:"navigation.html",link:function(n){n.auth=e}}}]),angular.module("experiment").directive("player",function(){return{restrict:"E",replace:!0,templateUrl:"player.html",scope:{video:"=",playlist:"="},link:function(e){return videojs("player").ready(function(){return e.player?void 0:(e.player=this,this.on("ended",function(){var n;return n=_.at(e.playlist,e.video.id),console.log("nextvideo",n)}))})},controller:["$scope",function(e){return e.$watch("playlist",function(n){var t;return console.log("playlist",n),e.video=getPlaybackVideo(n[null!=(t=e.video)?t.id:void 0])}),e.$watch("video",function(n){return n?void 0:e.video=getPlaybackVideo(null!=e?e.playlist[null!=n?n.id:void 0]:void 0)})}]}}),angular.module("experiment").directive("speechToggle",["$rootScope",function(e){return{restrict:"EA",templateUrl:"speech-toggle.html",link:function(n,t){n.speaking=!1,n.speechEnabled=!0,n.disableSpeech=function(){e.$broadcast("ba-speech-disable")},n.enableSpeech=function(){e.$broadcast("ba-speech-enable")},e.$on("ba-speech-disable",function(){n.$apply(function(){n.speechEnabled=!1})}),e.$on("ba-speech-enable",function(){n.$apply(function(){n.speechEnabled=!0})});var r=function(){e.$broadcast(n.speechEnabled?"ba-speech-disable":"ba-speech-enable")};t.bind("click",function(){r()})}}}]),angular.module("experiment").directive("speech",["$window",function(e){return{restrict:"A",link:function(n,t,r){if(e.speechSynthesis){n.enabled=!0,t.addClass("ba-speech");var i=new e.SpeechSynthesisUtterance,o=function(e){e?t.addClass("speaking"):t.removeClass("speaking"),n.speaking=e};i.onstart=function(){o(!0)},i.onend=function(){o(!1)},i.onpause=function(){o(!1)},i.onresume=function(){o(!0)},e.speechSynthesis.onvoiceschanged=function(){i.voice=a(r.language),r.debug&&console.log(i.voice),i.voiceURI=i.voice.voiceURI,i.lang=i.voice.lang,i.volume=1,i.rate=1.2,i.pitch=1};var a=function(n){var t=e.speechSynthesis.getVoices(),r=_(t).findWhere({"default":!0}),i=_(t).findWhere({lang:n});return i?i:r},u=function(t){t&&n.enabled&&(i.text=t,e.speechSynthesis.speak(i))};angular.element(t).bind("click",function(){e.speechSynthesis.cancel(),u(r.speech)}),n.$on("ba-speech-disable",function(){e.speechSynthesis.cancel(),n.enabled=!1}),n.$on("ba-speech-enable",function(){n.enabled=!0})}}}}]);