angular.module("experiment",["ngRoute","ngCookies","templates","firebase","ui.bootstrap"]).run(["$cookies","utils","analytics",function(e,t,n){e.guid||(e.guid=t.createGuid()),n.identify(e.guid)}]),angular.module("experiment").factory("BaseCollection",["BaseModel",function(e){var t=function(){function t(t){if(t){var n=!_(t).isArray();this.models=n?[t]:t,this.models=this.models.map(function(t){return t instanceof e?t:new e(t)})}}return t.prototype.model=e,t}();return t}]),angular.module("experiment").factory("InstrumentCollection",["BaseCollection","BaseModel","InstrumentModel",function(e,t,n){var r=function(){function r(r){if(r){var i=!_(r).isArray();this.models=i?[r]:r,this.models=this.models.map(function(e){return e instanceof t?e:new n(e)}),e.call(this,this.models)}}return r.prototype=Object.create(e.prototype),r.prototype.model=n,r.prototype.activateNext=function(){var e=_(this.models).find(function(e){return e.get("active")});if(e){var t=this.models.indexOf(e),n=t+1<this.models.length?t+1:0;this.models[t].set("active",!1),this.models[n].set("active",!0),this.models[n].get("enabled")&&this.models[n].playSound()}else _.isEmpty(this.models)||_.first(this.models).set("active",!0)},r}();return r}]),angular.module("experiment").service("config",["$window",function(e){return{env:"development",firebase:{"default":new e.Firebase("https://gunslngr.firebaseio.com/"),users:new e.Firebase("https://gunslngr.firebaseio.com/users"),clock:new e.Firebase("https://gunslngr.firebaseio.com/.info/serverTimeOffset"),auth:{facebook:{scope:"user_friends,user_birthday,friends_birthday",rememberMe:!0},github:{scope:"user:email",rememberMe:!0},twitter:{rememberMe:!0}}}}}]);var routes={"/":{templateUrl:"home.html"},"/speech":{templateUrl:"speech.html"},"/splice":{templateUrl:"splice.html"}};angular.module("experiment").config(["$routeProvider",function(e){for(var t in routes)e.when(t,routes[t]);return e.otherwise({redirectTo:"/404"})}]),angular.module("experiment").controller("uploadsController",["$scope","firebase",function(e,t){return e.userUploads=[],e.gridOptions={data:"userUploads",columnDefs:[{field:"displayName",displayName:"Name"},{field:"filename",displayName:"Filename"},{field:"job",displayName:"Zencoder Job"},{field:"size",displayName:"Size"}]},e.userUploads=t.userUploads}]),angular.module("experiment").directive("contenteditable",function(){return{restrict:"A",require:"ngModel",scope:{onBlur:"&"},link:function(e,t,n,r){return t.bind("keypress",function(){return function(e){return 13===e.keyCode?(e.preventDefault(),$(t).trigger("blur")):void 0}}(this)),t.bind("blur",function(){return e.$apply(function(){return r.$setViewValue(t.html()),t.addClass("edited"),e.onBlur()})}),r.$render=function(){return function(){return t.html(r.$viewValue)}}(this),r.$render()}}}),angular.module("experiment").directive("drumMachine",["$interval","InstrumentCollection","InstrumentModel","audio",function(e,t,n,r){return{restrict:"E",replace:!0,templateUrl:"drum-machine.html",link:function(i){var o=function(e){return Math.round(60/e*1e3)},a=function(){i.isPlaying=!0,c=e(function(){i.kickCollection.activateNext(),i.snareCollection.activateNext(),i.hihatCollection.activateNext()},o(i.song.bpm))},u=function(){i.isPlaying=!1,e.cancel(c)},s=function(){return i.song.beats*i.song.measures},c=void 0;i.isPlaying=!1,i.song={beats:4,measures:2,bpm:120},i.play=a,i.stop=u,i.audio=r;for(var l=[],d=[],p=[],f=0;f<s();f++)l.push(new n({soundUrl:"assets/sample-kick.mp3"})),d.push(new n({soundUrl:"assets/sample-snare.mp3"})),p.push(new n({soundUrl:"assets/sample-hihat.mp3"}));i.kickCollection=new t(l),i.snareCollection=new t(d),i.hihatCollection=new t(p)}}}]),angular.module("experiment").directive("filepicker",["$window","firebase","analytics","zencoder",function(e,t,n,r){return{restrict:"A",link:function(t){return t.filepicker=e.filepicker,t.filepicker.setKey("AiCDu1zCuQQysPoX9Mb9bz")},controller:["$scope",function(e){var i,o,a,u,s;return o={picker:{services:["COMPUTER","DROPBOX","BOX","GOOGLE_DRIVE"],container:"window",multiple:!0,mimetype:"video/*"},store:{path:"uploads/"+t.guid+"/"}},s=function(e){return a(e),u(e),n.track("Upload: Success",e)},i=function(e){return n.track("Upload: Error",e.toString())},a=function(e){return _(e).each(function(e){var n;return n=_.getFilename(e.key),e.displayName=n,t.userUploads[n]=e,t.userUploads.$save(n)})},u=function(e){var n;return n=_(e).pluck("key"),_(n).each(function(e){var n;return n=_.getFilename(e),console.log("filename",n),r.createJob(e).then(function(e){return t.userUploads.$child(n).$update({job:e.data.id}),t.userEncodes.$child(n).$update({jobId:e.data.id,files:e.data.outputs})})})},e.pick=function(){return e.filepicker.pickAndStore(o.picker,o.store,s,i)}}]}}]),angular.module("experiment").directive("icon",function(){return{restrict:"EA",replace:!0,templateUrl:"icon.html",scope:{glyph:"@"}}}),angular.module("experiment").directive("instrument",["$window","$http","audio",function(){return{restrict:"E",replace:!0,scope:{model:"="},templateUrl:"instrument.html",link:function(e,t){e.enabled=!1,t.bind("click",function(){e.$apply(function(){e.model.set("enabled",!e.model.get("enabled")),e.model.loadSound()})})}}}]),angular.module("experiment").directive("navigation",["auth",function(e){return{restrict:"E",replace:!0,templateUrl:"navigation.html",link:function(t){t.auth=e}}}]),angular.module("experiment").directive("player",function(){return{restrict:"E",replace:!0,templateUrl:"player.html",scope:{video:"=",playlist:"="},link:function(e){return videojs("player").ready(function(){return e.player?void 0:(e.player=this,this.on("ended",function(){var t;return t=_.at(e.playlist,e.video.id),console.log("nextvideo",t)}))})},controller:["$scope",function(e){return e.$watch("playlist",function(t){var n;return console.log("playlist",t),e.video=getPlaybackVideo(t[null!=(n=e.video)?n.id:void 0])}),e.$watch("video",function(t){return t?void 0:e.video=getPlaybackVideo(null!=e?e.playlist[null!=t?t.id:void 0]:void 0)})}]}}),angular.module("experiment").directive("speechToggle",["$rootScope",function(e){return{restrict:"EA",templateUrl:"speech-toggle.html",link:function(t,n){t.speaking=!1,t.speechEnabled=!0,t.disableSpeech=function(){e.$broadcast("ba-speech-disable")},t.enableSpeech=function(){e.$broadcast("ba-speech-enable")},e.$on("ba-speech-disable",function(){t.$apply(function(){t.speechEnabled=!1})}),e.$on("ba-speech-enable",function(){t.$apply(function(){t.speechEnabled=!0})});var r=function(){e.$broadcast(t.speechEnabled?"ba-speech-disable":"ba-speech-enable")};n.bind("click",function(){r()})}}}]),angular.module("experiment").directive("speech",["$window",function(e){return{restrict:"A",link:function(t,n,r){if(e.speechSynthesis){t.enabled=!0,n.addClass("ba-speech");var i=new e.SpeechSynthesisUtterance,o=function(e){e?n.addClass("speaking"):n.removeClass("speaking"),t.speaking=e};i.onstart=function(){o(!0)},i.onend=function(){o(!1)},i.onpause=function(){o(!1)},i.onresume=function(){o(!0)},e.speechSynthesis.onvoiceschanged=function(){i.voice=a(r.language),r.debug&&console.log(i.voice),i.voiceURI=i.voice.voiceURI,i.lang=i.voice.lang,i.volume=1,i.rate=1.2,i.pitch=1};var a=function(t){var n=e.speechSynthesis.getVoices(),r=_(n).findWhere({"default":!0}),i=_(n).findWhere({lang:t});return i?i:r},u=function(n){n&&t.enabled&&(i.text=n,e.speechSynthesis.speak(i))};angular.element(n).bind("click",function(){e.speechSynthesis.cancel(),u(r.speech)}),t.$on("ba-speech-disable",function(){e.speechSynthesis.cancel(),t.enabled=!1}),t.$on("ba-speech-enable",function(){t.enabled=!0})}}}}]),angular.module("experiment").filter("range",function(){return function(e,t){t=parseInt(t);for(var n=0;t>n;n++)e.push(n);return e}}),angular.module("experiment").factory("BaseModel",["utils",function(e){var t=function(){function t(e){this.attributes=e||{}}return t.prototype.get=function(t){return e.findValue(this.attributes,t)},t.prototype.set=function(e,t){var n=void 0;if("object"==typeof e)n=e;else{n={},n[e]=t;for(var r in n){var i=n[r];this.attributes[r]=i}}},t}();return t}]),angular.module("experiment").factory("InstrumentModel",["BaseModel","audio",function(e,t){var n=function(){function n(t){var n={type:"drum",name:"kick",active:!1};e.call(this,_.defaults(t,n))}return n.prototype=Object.create(e.prototype),n.prototype.toggleActive=function(){this.attributes.active=!this.attributes.active},n.prototype.loadSound=function(e){var n=this;t.load(e||this.get("soundUrl")).then(function(e){n.set("soundBuffer",e)})},n.prototype.playSound=function(){t.play(this.get("soundUrl"))},n}(e);return n}]),angular.module("experiment").factory("analytics",function(){var e={};return _(["page","pageview","track","identify"]).each(function(t){return e[t]=function(){var e=[].slice.call(arguments,0);return window.analytics[t].apply(window.analytics,e)}}),e}).run(["analytics","$rootScope",function(e,t){t.$on("$routeChangeSuccess",function(){e.page()})}]),angular.module("experiment").service("audio",["$window","$http","$q",function(e,t,n){var r=e.AudioContext||e.webkitAudioContext,i=new r,o=void 0,a=n.defer(),u=function(e){i.decodeAudioData(e.data,function(e){o=i.createBufferSource(),o.buffer=e,a.resolve(e)})},s=function(e){c(e).then(function(e){o.buffer=e,o.connect(i.destination),o.start(0)})},c=function(e){return t.get(e,{responseType:"arraybuffer"}).then(u),a=n.defer(),a.promise};return publicAPI={load:c,play:s}}]),angular.module("experiment").service("auth",["$firebase","$firebaseAuth","$cookies","config","$rootScope",function(e,t,n,r,i){var o=t(r.firebase["default"]),a=e(r.firebase.users),u=void 0,s=void 0,c=function(){var t=o.$getAuth();u=t?e(r.firebase.users.child(t.uid)).$asObject():null,i.user=u,u&&u.$bindTo(i,"user").then(function(e){s=e})},l=function(e){o.$getAuth()?a.$update(e.uid,e[e.provider]):a.$set(e.uid,e[e.provider]),c()},d=function(e){console.error("login error",e)},p=function(e){switch(e){case"facebook":return o.$authWithOAuthPopup("facebook").then(l)["catch"](d);case"github":return o.$authWithOAuthPopup("github").then(l)["catch"](d);case"twitter":return o.$authWithOAuthPopup("twitter").then(l)["catch"](d)}},f=function(){s(),o.$unauth(),i.user=null};return c(),{login:p,logout:f}}]),angular.module("experiment").service("firebase",["$firebase","$cookies","config","$rootScope","$q",function(e,t,n,r,i){var o=new Firebase(n.firebase.clock);return guid=t.guid,getServerTime=function(){var e=i.defer();return o.on("value",function(t){var n=Date.now()+t.val();return e.resolve(n)}),e.promise},publicAPI={getServerTime:getServerTime,guid:guid}}]),angular.module("experiment").service("liveSync",["firebase","$window",function(e,t){var n,r,i;return navigator.getMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia,n=t.AudioContext||t.webkitAudioContext,i=function(e,t,r){var i,o,a;return o=(t-e)%r,console.log("jumpTo (in seconds)",o/1e3),console.log("jumpTo (in minutes)",o/1e3/60),i={video:!1,audio:!0},a=function(e){var t,r,i;return t=new n,i=t.createMediaStreamSource(e),r=t.createBiquadFilter(),i.connect(r),r.connect(t.destination)},navigator.getMedia(i,a)},e.getServerTime().then(function(e){var t,n;return n=13956876e5,t=132e4,i(n,e,t)}),r={sync:i}}]),angular.module("experiment").service("utils",function(){var e=function(e){return _.isUndefined(e)?!1:!_.isObject(e)||_.isFunction(e)||_.isArray(e)||_.isElement(e)?!1:!0},t=function(e){return _(e).isNumber()&&!_(e).isNaN()?!0:!1},n=function(e){var n=parseInt(e,10);return t(n)?n:e},r=function(e,t){if(!_.isString(t)||_.isEmpty(t)||!e)throw new Error("The second argument supplied to findValue() should be a string of the property name that you're looking for.");var n=null;return _.find(e,function(e,i){return String(i).toLowerCase()===String(t).toLowerCase()?n=e:_.isObject(e)&&!_.isElement(e)&&(n=r(e,t)),null!=n?n:void 0}),n},i=function(e,t){if(!_.isArray(t))throw new Error("findValues() expects an array of strings for property names to find");var n={};return _.each(t,function(e){return n[e]=r(this,e)},e),n},o=function(e,t){var n={};if(!_.isObject(e||!_.isObject(t)))throw new Error("Both arguments supplied to override() should be shallow objects.");return n=_.defaults(e,t),angular.forEach(e,function(e,r){return angular.forEach(t,function(e,t){return r===t?n[r]=e:void 0})}),n},a=function(e,t){var n=_.last(e.split("/"));return t||(t=!0),t?_.first(n.split(".")):n},u=function(){function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()};return publicAPI={isTrueObject:e,isValidNumber:t,makeNumber:n,findValue:r,findValues:i,override:o,getFilename:a,createGuid:u}}),angular.module("experiment").service("zencoder",["$http","firebase",function(e,t){var n,r,i,o,a,u,s;return a=t.guid,n="https://app.zencoder.com/api/v2",u={read:"92cdc58ec35e590acb0980f75ddfa32c",full:"380e390b6b8fd2d600c9035db7d13c29"},r=function(t){return e.post(""+n+"/jobs",o(t))},i=function(t){return e.get(""+n+"/jobs/"+t+"/progress.json?api_key="+u.full)},o=function(e){var t;return t=_.getFilename(e),n="s3://fullscreen-tv",{input:""+n+"/"+e,outputs:[{label:"low",format:"mp4",video_bitrate:200,decoder_bitrate_cap:300,decoder_buffer_size:1200,audio_sample_rate:44100,height:"288",url:""+n+"/encodes/"+a+"/"+t+"-low.mp4",h264_reference_frames:1,forced_keyframe_rate:"0.1",audio_bitrate:56,decimate:2,rrs:!0},{label:"high",format:"mp4",video_bitrate:1e3,decoder_bitrate_cap:1500,decoder_buffer_size:6e3,audio_sample_rate:44100,height:"432",url:""+n+"/encodes/"+a+"/"+t+"-high.mp4",h264_reference_frames:"auto",h264_profile:"main",forced_keyframe_rate:"0.1",audio_bitrate:56,rrs:!0},{source:"low",segment_video_snapshots:"true",url:""+n+"/encodes/"+a+"/"+t+"-audio-only.m4a",copy_audio:"true",skip_video:"true",label:"hls-audio-only",type:"segmented",format:"aac",rrs:!0},{source:"low",format:"ts",copy_audio:"true",copy_video:"true",url:""+n+"/encodes/"+a+"/"+t+"-hls-low.mp4",label:"hls-low",type:"segmented",rrs:!0},{source:"high",format:"ts",copy_audio:"true",copy_video:"true",url:""+n+"/encodes/"+a+"/"+t+"-hls-high.mp4",label:"hls-high",type:"segmented",rrs:!0},{streams:[{path:"hls-low/"+t+"-hls-low.m3u8",bandwidth:256},{path:"hls-audio-only/"+t+"-hls-audio-only.m3u8",bandwidth:56},{path:"hls-high/"+t+"-hls-high.m3u8",bandwidth:1056}],type:"playlist",url:""+n+"/encodes/"+a+"/"+t+".m3u8"}]}},s={createJob:r,getJobProgress:i}}]).config(["$httpProvider",function(e){return e.defaults.headers.common={},e.defaults.headers.post={},e.defaults.headers.post["Zencoder-Api-Key"]="380e390b6b8fd2d600c9035db7d13c29"}]);