angular.module("experiment",["ngRoute","ngCookies","templates","firebase","ui.bootstrap"]).run(["$cookies","utils","analytics",function(e,r,t){e.guid||(e.guid=r.createGuid()),t.identify(e.guid)}]),angular.module("experiment").directive("contenteditable",function(){return{restrict:"A",require:"ngModel",scope:{onBlur:"&"},link:function(e,r,t,n){return r.bind("keypress",function(){return function(e){return 13===e.keyCode?(e.preventDefault(),$(r).trigger("blur")):void 0}}(this)),r.bind("blur",function(){return e.$apply(function(){return n.$setViewValue(r.html()),r.addClass("edited"),e.onBlur()})}),n.$render=function(){return function(){return r.html(n.$viewValue)}}(this),n.$render()}}}),angular.module("experiment").directive("filepicker",["$window","firebase","analytics","zencoder",function(e,r,t,n){return{restrict:"A",link:function(r){return r.filepicker=e.filepicker,r.filepicker.setKey("AiCDu1zCuQQysPoX9Mb9bz")},controller:["$scope",function(e){var i,o,a,u,s;return o={picker:{services:["COMPUTER","DROPBOX","BOX","GOOGLE_DRIVE"],container:"window",multiple:!0,mimetype:"video/*"},store:{path:"uploads/"+r.guid+"/"}},s=function(e){return a(e),u(e),t.track("Upload: Success",e)},i=function(e){return t.track("Upload: Error",e.toString())},a=function(e){return _(e).each(function(e){var t;return t=_.getFilename(e.key),e.displayName=t,r.userUploads[t]=e,r.userUploads.$save(t)})},u=function(e){var t;return t=_(e).pluck("key"),_(t).each(function(e){var t;return t=_.getFilename(e),console.log("filename",t),n.createJob(e).then(function(e){return r.userUploads.$child(t).$update({job:e.data.id}),r.userEncodes.$child(t).$update({jobId:e.data.id,files:e.data.outputs})})})},e.pick=function(){return e.filepicker.pickAndStore(o.picker,o.store,s,i)}}]}}]),angular.module("experiment").directive("navigation",["auth",function(e){return{restrict:"E",replace:!0,templateUrl:"navigation.html",link:function(r){r.auth=e}}}]),angular.module("experiment").directive("player",function(){return{restrict:"E",replace:!0,templateUrl:"player.html",scope:{video:"=",playlist:"="},link:function(e){return videojs("player").ready(function(){return e.player?void 0:(e.player=this,this.on("ended",function(){var r;return r=_.at(e.playlist,e.video.id),console.log("nextvideo",r)}))})},controller:["$scope",function(e){return e.$watch("playlist",function(r){var t;return console.log("playlist",r),e.video=getPlaybackVideo(r[null!=(t=e.video)?t.id:void 0])}),e.$watch("video",function(r){return r?void 0:e.video=getPlaybackVideo(null!=e?e.playlist[null!=r?r.id:void 0]:void 0)})}]}}),angular.module("experiment").directive("speechToggle",["$rootScope",function(e){return{restrict:"EA",templateUrl:"speech-toggle.html",link:function(r,t){r.speaking=!1,r.speechEnabled=!0,r.disableSpeech=function(){e.$broadcast("ba-speech-disable")},r.enableSpeech=function(){e.$broadcast("ba-speech-enable")},e.$on("ba-speech-disable",function(){r.$apply(function(){r.speechEnabled=!1})}),e.$on("ba-speech-enable",function(){r.$apply(function(){r.speechEnabled=!0})});var n=function(){e.$broadcast(r.speechEnabled?"ba-speech-disable":"ba-speech-enable")};t.bind("click",function(){n()})}}}]),angular.module("experiment").directive("speech",["$window",function(e){return{restrict:"A",link:function(r,t,n){if(e.speechSynthesis){r.enabled=!0,t.addClass("ba-speech");var i=new e.SpeechSynthesisUtterance,o=function(e){e?t.addClass("speaking"):t.removeClass("speaking"),r.speaking=e};i.onstart=function(){o(!0)},i.onend=function(){o(!1)},i.onpause=function(){o(!1)},i.onresume=function(){o(!0)},e.speechSynthesis.onvoiceschanged=function(){i.voice=a(n.language),n.debug&&console.log(i.voice),i.voiceURI=i.voice.voiceURI,i.lang=i.voice.lang,i.volume=1,i.rate=1.2,i.pitch=1};var a=function(r){var t=e.speechSynthesis.getVoices(),n=_(t).findWhere({"default":!0}),i=_(t).findWhere({lang:r});return i?i:n},u=function(t){t&&r.enabled&&(i.text=t,e.speechSynthesis.speak(i))};angular.element(t).bind("click",function(){e.speechSynthesis.cancel(),u(n.speech)}),r.$on("ba-speech-disable",function(){e.speechSynthesis.cancel(),r.enabled=!1}),r.$on("ba-speech-enable",function(){r.enabled=!0})}}}}]),angular.module("experiment").controller("uploadsController",["$scope","firebase",function(e,r){return e.userUploads=[],e.gridOptions={data:"userUploads",columnDefs:[{field:"displayName",displayName:"Name"},{field:"filename",displayName:"Filename"},{field:"job",displayName:"Zencoder Job"},{field:"size",displayName:"Size"}]},e.userUploads=r.userUploads}]),angular.module("experiment").factory("analytics",function(){var e={};return _(["page","pageview","track","identify"]).each(function(r){return e[r]=function(){var e=[].slice.call(arguments,0);return window.analytics[r].apply(window.analytics,e)}}),e}).run(["analytics","$rootScope",function(e,r){r.$on("$routeChangeSuccess",function(){e.page()})}]),angular.module("experiment").service("auth",["$firebase","$firebaseAuth","$cookies","config","$rootScope",function(e,r,t,n,i){var o=r(n.firebase["default"]),a=e(n.firebase.users),u=void 0,s=function(){var r=o.$getAuth();r&&(u=e(n.firebase.users.child(r.uid)).$asObject(),i.user=u,u.$bindTo(i,"user"))}(),c=function(e){o.$getAuth()?a.$set(e.uid,e[e.provider]):a.$update(e.uid,e[e.provider]),s()},l=function(e){console.error("login error",e)},d=function(e){switch(e){case"facebook":return o.$authWithOAuthPopup("facebook").then(c)["catch"](l);case"github":return o.$authWithOAuthPopup("github").then(c)["catch"](l);case"twitter":return o.$authWithOAuthPopup("twitter").then(c)["catch"](l)}};return{login:d,user:u}}]),angular.module("experiment").constant("config",{env:"development",firebase:{"default":new Firebase("https://drum-machine.firebaseio.com/"),users:new Firebase("https://drum-machine.firebaseio.com/users"),clock:new Firebase("https://drum-machine.firebaseio.com/.info/serverTimeOffset"),auth:{facebook:{scope:"user_friends,user_birthday,friends_birthday",rememberMe:!0},github:{scope:"user:email",rememberMe:!0},twitter:{rememberMe:!0}}}}),angular.module("experiment").service("firebase",["$firebase","$cookies","config","$rootScope","$q",function(e,r,t,n,i){var o=new Firebase(t.firebase.clock);return guid=r.guid,getServerTime=function(){var e=i.defer();return o.on("value",function(r){var t=Date.now()+r.val();return e.resolve(t)}),e.promise},publicAPI={getServerTime:getServerTime,guid:guid}}]),angular.module("experiment").service("liveSync",["firebase","$window",function(e,r){var t,n,i;return navigator.getMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia,t=r.AudioContext||r.webkitAudioContext,i=function(e,r,n){var i,o,a;return o=(r-e)%n,console.log("jumpTo (in seconds)",o/1e3),console.log("jumpTo (in minutes)",o/1e3/60),i={video:!1,audio:!0},a=function(e){var r,n,i;return r=new t,i=r.createMediaStreamSource(e),n=r.createBiquadFilter(),i.connect(n),n.connect(r.destination)},navigator.getMedia(i,a)},e.getServerTime().then(function(e){var r,t;return t=13956876e5,r=132e4,i(t,e,r)}),n={sync:i}}]);var routes={"/":{templateUrl:"home.html"},"/speech":{templateUrl:"speech.html"},"/drum-machine":{templateUrl:"drum-machine.html"}};angular.module("experiment").config(["$routeProvider",function(e){for(var r in routes)e.when(r,routes[r]);return e.otherwise({redirectTo:"/404"})}]),angular.module("experiment").service("utils",function(){var e=function(e){return _.isUndefined(e)?!1:!_.isObject(e)||_.isFunction(e)||_.isArray(e)||_.isElement(e)?!1:!0},r=function(e){return _(e).isNumber()&&!_(e).isNaN()?!0:!1},t=function(e){var t=parseInt(e,10);return r(t)?t:e},n=function(e,r){if(!_.isString(r)||_.isEmpty(r)||!e)throw new Error("The second argument supplied to findValue() should be a string of the property name that you're looking for.");var t=null;return _.find(e,function(e,i){return String(i).toLowerCase()===String(r).toLowerCase()?t=e:_.isObject(e)&&!_.isElement(e)&&(t=n(e,r)),null!=t?t:void 0}),t},i=function(e,r){if(!_.isArray(r))throw new Error("findValues() expects an array of strings for property names to find");var t={};return _.each(r,function(e){return t[e]=n(this,e)},e),t},o=function(e,r){var t={};if(!_.isObject(e||!_.isObject(r)))throw new Error("Both arguments supplied to override() should be shallow objects.");return t=_.defaults(e,r),angular.forEach(e,function(e,n){return angular.forEach(r,function(e,r){return n===r?t[n]=e:void 0})}),t},a=function(e,r){var t=_.last(e.split("/"));return r||(r=!0),r?_.first(t.split(".")):t},u=function(){function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()};return publicAPI={isTrueObject:e,isValidNumber:r,makeNumber:t,findValue:n,findValues:i,override:o,getFilename:a,createGuid:u}}),angular.module("experiment").service("zencoder",["$http","firebase",function(e,r){var t,n,i,o,a,u,s;return a=r.guid,t="https://app.zencoder.com/api/v2",u={read:"92cdc58ec35e590acb0980f75ddfa32c",full:"380e390b6b8fd2d600c9035db7d13c29"},n=function(r){return e.post(""+t+"/jobs",o(r))},i=function(r){return e.get(""+t+"/jobs/"+r+"/progress.json?api_key="+u.full)},o=function(e){var r;return r=_.getFilename(e),t="s3://fullscreen-tv",{input:""+t+"/"+e,outputs:[{label:"low",format:"mp4",video_bitrate:200,decoder_bitrate_cap:300,decoder_buffer_size:1200,audio_sample_rate:44100,height:"288",url:""+t+"/encodes/"+a+"/"+r+"-low.mp4",h264_reference_frames:1,forced_keyframe_rate:"0.1",audio_bitrate:56,decimate:2,rrs:!0},{label:"high",format:"mp4",video_bitrate:1e3,decoder_bitrate_cap:1500,decoder_buffer_size:6e3,audio_sample_rate:44100,height:"432",url:""+t+"/encodes/"+a+"/"+r+"-high.mp4",h264_reference_frames:"auto",h264_profile:"main",forced_keyframe_rate:"0.1",audio_bitrate:56,rrs:!0},{source:"low",segment_video_snapshots:"true",url:""+t+"/encodes/"+a+"/"+r+"-audio-only.m4a",copy_audio:"true",skip_video:"true",label:"hls-audio-only",type:"segmented",format:"aac",rrs:!0},{source:"low",format:"ts",copy_audio:"true",copy_video:"true",url:""+t+"/encodes/"+a+"/"+r+"-hls-low.mp4",label:"hls-low",type:"segmented",rrs:!0},{source:"high",format:"ts",copy_audio:"true",copy_video:"true",url:""+t+"/encodes/"+a+"/"+r+"-hls-high.mp4",label:"hls-high",type:"segmented",rrs:!0},{streams:[{path:"hls-low/"+r+"-hls-low.m3u8",bandwidth:256},{path:"hls-audio-only/"+r+"-hls-audio-only.m3u8",bandwidth:56},{path:"hls-high/"+r+"-hls-high.m3u8",bandwidth:1056}],type:"playlist",url:""+t+"/encodes/"+a+"/"+r+".m3u8"}]}},s={createJob:n,getJobProgress:i}}]).config(["$httpProvider",function(e){return e.defaults.headers.common={},e.defaults.headers.post={},e.defaults.headers.post["Zencoder-Api-Key"]="380e390b6b8fd2d600c9035db7d13c29"}]);